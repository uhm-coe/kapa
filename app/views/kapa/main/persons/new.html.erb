<% content_for(:head) do %>
  <script type="text/javascript">
    jQuery(document).ready(function($) {
      var lookup_person = function(condition) {
        if($(this).val().match(new RegExp(condition, "i"))) {
          $.getJSON('<%=kapa_main_persons_lookup_path(:id => @person)%>',
                    {key: $(this).val()},
                    function(data) {
                      var update_form = function(data) {
                        alert(data['message']);
                        if(data['redirect_path']) {
                          window.location.href = data['redirect_path']
                        }
                        if(data['person']) {
                          $('#person_id_number').val(data['person']['id_number']);
                          $('#person_email').val(data['person']['email']);
                          $('#person_last_name').val(data['person']['last_name']);
                          $('#person_first_name').val(data['person']['first_name']);
                          $('#person_status').val(data['person']['status']);
                        }
                    }
                   );
        }
      }
      $('#person_id_number').keyup(lookup_person("<%=Rails.configuration.regex_id_number %>"));
      $('#person_email').keyup(lookup_person("<%=Rails.configuration.regex_email %>"));
    });
  </script>
<%end%>

<% content_for(:box1) do %>

  <h4 class="section-header">
    <%=link_to "", {:action => :index}, :class => "glyphicon glyphicon-chevron-left" %>
    New Person
  </h4>

  <%=label_form_for :person, :url => kapa_main_persons_path, :remote => true do %>
    <div id="person_form">
      <%=render :partial => "/kapa/main/person_form" %>
    </div>
    <%=controls if @current_user.write? %>
  <% end %>

<% end %>

