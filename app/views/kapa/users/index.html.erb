<% content_for(:dialog) do %>

  <%=render :layout => '/kapa/layouts/modal', :locals => {:modal_id => "filter_dialog", :modal_title => "Search", :modal_form_id => "filter_form"} do %>
    <%=bootstrap_form_for(:filter, :url => kapa_users_path, :html => {:method => :get, :id => "filter_form"}) do |f| %>
      <%=f.text_field :user_key, :size => 20, :label => "Name or UID" %>
      <%=f.select :status, Rails.configuration.user_status, {:include_blank => "Any", :label => "User Status"} %>
      <%=f.select :category, Rails.configuration.user_categories, :include_blank => "Any" %>
      <%=f.property_select :depts, {:label => t(:kapa_global_dept).pluralize, :include_blank => "Any"}, :multiple => true if manage? %>
      <%=f.select :per_page, Rails.configuration.items_per_page_selections %>
    <% end %>
  <% end %>

  <%=render :layout => '/kapa/layouts/modal', :locals => {:modal_id => "import_dialog", :modal_title => "Import User Data", :modal_form_id => "import_user_form"} do %>
    <%=bootstrap_form_for(:data, :url => import_kapa_users_path, :html => {:multipart => true, :id => "import_user_form"}) do |f|%>
      <%=f.file_field :import_file %>
    <% end %>
  <% end %>

<% end %>

<% content_for(:box1) do %>

  <h3>Users</h3>

  <div class="row">
    <div class="col-sm-12 text-right">

      <%=button_to_link "New", {:action => :new}, :icon => "glyphicon-plus" if create? %>
      <% if import? %><button type="button" class="btn btn-default" data-toggle="modal" data-target="#import_dialog">Import</button><% end %>
      <%=button_to_link "Download", {:action => :export}, :icon => "glyphicon-download" %>
      <%=button_to_link "Search", nil, "data-toggle" => "modal", "data-target" => "#filter_dialog", :icon => "glyphicon-search" %>
    </div>
  </div>

  <table id="user_list" class="table table-striped">
    <thead>
      <tr>
        <th>User ID</th>
        <th>Name</th>
        <th>Auth Type</th>
        <th>Role</th>
        <th>Status</th>
        <th><%="Primary #{t(:kapa_global_dept)}"%></th>
        <th><%="#{t(:kapa_global_dept).pluralize.pluralize}"%></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% for user in @users %>
        <tr>
          <td><%=user.uid %></td>
          <td><%=user.person.full_name if user.person %></td>
          <td><%=user.category %></td>
          <td><%=user.deserialize(:permission, :as => OpenStruct).role %></td>
          <td><%=user.status_desc %></td>
          <td><%=user.primary_dept %></td>
          <td><%=user.depts.join(", ") %></td>
          <td class="right"><%=link_to "Show", {:action => "show", :id => user}, :class => "btn btn-default btn-xs" %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <div class="text-center"><%=will_paginate @users, :renderer => BootstrapPagination::Rails %></div>

<% end %>
